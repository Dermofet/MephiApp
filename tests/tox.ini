[tox]
envlist = py39

[testenv]
deps =
    pytest
    pytest-dotenv
    pytest-trio
    sqlalchemy
    asyncpg
    fastapi
    fastapi_filter
    faker
docker = db
commands =
    pytest

[docker:db]
image = postgres:13.1-alpine

environment =
 POSTGRES_PASSWORD=postgres
 POSTGRES_USER=postgres
 POSTGRES_DB=postgres

healthcheck_cmd = PGPASSWORD=$POSTGRES_PASSWORD psql \
 --user=$POSTGRES_USER --dbname=$POSTGRES_DB \
 --host=127.0.0.1 --quiet --no-align --tuples-only \
 -1 --command="SELECT 1"
healthcheck_timeout = 5
healthcheck_retries = 30
healthcheck_interval = 1
healthcheck_start_period = 3

ports =
    5555:5432/tcp